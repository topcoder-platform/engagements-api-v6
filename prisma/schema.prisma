generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

enum EngagementStatus {
  OPEN
  PENDING_ASSIGNMENT
  CLOSED
}

enum ApplicationStatus {
  SUBMITTED
  UNDER_REVIEW
  ACCEPTED
  REJECTED
}

enum Role {
  DESIGNER
  SOFTWARE_DEVELOPER
  DATA_SCIENTIST
  DATA_ENGINEER
}

enum Workload {
  FULL_TIME
  FRACTIONAL
}

model Engagement {
  id                  String                  @id @default(uuid())
  projectId           String
  title               String
  description         String
  durationStartDate   DateTime?
  durationEndDate     DateTime?
  durationWeeks       Int?
  durationMonths      Int?
  timeZones           String[]
  countries           String[]
  requiredSkills      String[]
  applicationDeadline DateTime
  status              EngagementStatus        @default(OPEN)
  role                Role?
  workload            Workload?
  compensationRange   String?
  createdAt           DateTime                @default(now())
  createdBy           String
  updatedAt           DateTime                @updatedAt
  updatedBy           String?
  assignedMemberId    String?
  assignedMemberHandle String?

  applications        EngagementApplication[]
  feedbacks           EngagementFeedback[]

  @@index([projectId])
  @@index([status])
  @@index([applicationDeadline])
  @@index([status, applicationDeadline])
  @@index([assignedMemberId])
  @@index([role])
  @@index([workload])
}

model EngagementApplication {
  id                String            @id @default(uuid())
  engagementId      String
  userId            String
  email             String
  name              String
  address           String?
  coverLetter       String?
  resumeUrl         String?
  portfolioUrls     String[]
  yearsOfExperience Int?
  availability      String?
  status            ApplicationStatus @default(SUBMITTED)
  createdAt         DateTime          @default(now())
  updatedAt         DateTime          @updatedAt
  updatedBy         String?

  engagement        Engagement        @relation(fields: [engagementId], references: [id], onDelete: Cascade)

  @@unique([engagementId, userId])
  @@index([userId])
  @@index([engagementId])
  @@index([status])
}

model EngagementFeedback {
  id                    String    @id @default(uuid())
  engagementId          String
  feedbackText          String
  rating                Int?
  givenByMemberId       String?
  givenByHandle         String?
  givenByEmail          String?
  secretToken           String?   @unique
  secretTokenExpiresAt  DateTime?
  createdAt             DateTime  @default(now())
  updatedAt             DateTime  @updatedAt

  engagement            Engagement @relation(fields: [engagementId], references: [id], onDelete: Cascade)

  @@index([engagementId])
  @@index([givenByMemberId])
}
