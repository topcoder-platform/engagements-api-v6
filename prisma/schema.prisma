generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum EngagementStatus {
  OPEN
  PENDING_ASSIGNMENT
  CLOSED
}

enum ApplicationStatus {
  SUBMITTED
  UNDER_REVIEW
  ACCEPTED
  REJECTED
}

model Engagement {
  id                  String                  @id @default(nanoid())
  projectId           String
  title               String
  description         String
  durationStartDate   DateTime?
  durationEndDate     DateTime?
  durationWeeks       Int?
  durationMonths      Int?
  timeZones           String[]
  countries           String[]
  requiredSkills      String[]
  applicationDeadline DateTime
  status              EngagementStatus        @default(OPEN)
  createdAt           DateTime                @default(now())
  createdBy           String
  updatedAt           DateTime                @updatedAt
  updatedBy           String?

  applications        EngagementApplication[]

  @@index([projectId])
  @@index([status])
  @@index([applicationDeadline])
  @@index([status, applicationDeadline])
}

model EngagementApplication {
  id                String            @id @default(nanoid())
  engagementId      String
  userId            String
  email             String
  name              String
  address           String?
  coverLetter       String?
  resumeUrl         String?
  portfolioUrls     String[]
  yearsOfExperience Int?
  availability      String?
  status            ApplicationStatus @default(SUBMITTED)
  createdAt         DateTime          @default(now())
  updatedAt         DateTime          @updatedAt
  updatedBy         String?

  engagement        Engagement        @relation(fields: [engagementId], references: [id], onDelete: Cascade)

  @@unique([engagementId, userId])
  @@index([userId])
  @@index([engagementId])
  @@index([status])
}
